<!DOCTYPE html>
<html>
<head>
  <title>Access Request (Mode A / Mode B / IPFS)</title>
</head>
<body>
  <h2>Step 5 — Request Data Access or Upload File to IPFS</h2>

  {% if error %}
    <p style="color:red;">{{ error }}</p>
  {% endif %}

  <form method="POST" enctype="multipart/form-data">
    <label>Mode:</label><br>
    <select name="mode" id="mode_select" onchange="onModeChange()">
      <option value="value">Mode A — Direct Value (allowed fields)</option>
      <option value="predicate">Mode B — Predicate (selective disclosure)</option>
      <option value="file">Upload File → IPFS (file access token)</option>
    </select><br><br>

    <div id="value_block">
      <label>Field (Mode A):</label><br>
      <select name="field">
        <option value="gender">gender</option>
        <option value="aadhaar_hash">aadhaar_hash</option>
        <option value="dob">dob</option>
        <option value="address">address</option>
      </select><br><br>
    </div>

    <div id="predicate_block" style="display:none;">
      <label>Predicate (Mode B):</label><br>
      <select name="op">
        <option value="gt">gt (greater than)</option>
        <option value="ge">ge (greater or equal)</option>
        <option value="eq">eq (equal)</option>
        <option value="in">in (membership)</option>
      </select>
      <input type="text" name="pred_field" placeholder="field (e.g. age, gender, address_city)">
      <input type="text" name="pred_value" placeholder="value (e.g. 18 or male)">
      <br><br>
    </div>

    <div id="file_block" style="display:none;">
      <label>Choose file to upload to IPFS:</label><br>
      <input type="file" name="file"><br><br>
    </div>

    <label>Token TTL seconds (0 = no expiry, blank = default 300s):</label><br>
    <input type="number" name="ttl_seconds" min="0" placeholder="300"><br><br>

    <button type="submit">Generate Token / Upload</button>
  </form>

  <br><a href="/">Home</a> | <a href="/tokens">Tokens (demo)</a>

<script>
function onModeChange(){
  const m = document.getElementById('mode_select').value;
  document.getElementById('value_block').style.display = (m==='value') ? 'block' : 'none';
  document.getElementById('predicate_block').style.display = (m==='predicate') ? 'block' : 'none';
  document.getElementById('file_block').style.display = (m==='file') ? 'block' : 'none';
}
</script>
</body>
</html>
